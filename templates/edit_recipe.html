{% extends "base.html" %}
{% block content %}

<div class="card">
  <h2>Recipe for: {{ menu_item.item_name }}</h2>
</div>

<!-- ================= ADD INGREDIENT ================= -->
<div class="card">
  <h3>‚ûï Add Ingredient</h3>

  <form method="post">
    <input type="hidden" name="action" value="add">

    <label>Warehouse Item</label>
    <select name="warehouse_item_id" required>
      {% for w in warehouse_items %}
        <option value="{{ w.item_id }}"
          {% if request.args.get('warehouse_item_id')
                and w.item_id == request.args.get('warehouse_item_id')|int %}
            selected
          {% endif %}
        >
          {{ w.item_name }} ({{ w.unit_of_measure }})
        </option>
      {% endfor %}
    </select>

    <label>Quantity Required</label>
    <input type="number"
           name="quantity_required"
           min="0.01"
           step="0.01"
           required>

    <button>Add Ingredient</button>

    {% if error == "exists" %}
      <p class="error">
        This warehouse item is already an ingredient in this recipe.
      </p>
    {% endif %}
  </form>
</div>

<!-- ================= CURRENT INGREDIENTS ================= -->
<div class="card">
  <h3>üìã Current Ingredients</h3>

  {% if ingredients %}
    <table class="table">
      <thead>
        <tr>
          <th>Ingredient</th>
          <th>Quantity</th>
          <th>Unit</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>

        {% for ing in ingredients %}
        <tr>
          <td>{{ ing.item_name }}</td>

          <!-- Quantity update -->
          <td>
            <form method="post" style="display:inline;">
              <input type="hidden" name="action" value="update">
              <input type="hidden" name="warehouse_item_id"
                     value="{{ ing.warehouse_item_id }}">

              <input type="number"
                     name="quantity_required"
                     value="{{ ing.quantity_required }}"
                     min="0.01"
                     step="0.01"
                     style="width:90px"
                     {% if ing.is_active == 0 %}disabled{% endif %}>

              <button class="btn-secondary"
                      {% if ing.is_active == 0 %}disabled{% endif %}>
                Update
              </button>
            </form>
          </td>

          <td>{{ ing.unit_of_measure }}</td>

          <!-- Status -->
          <td>
            {% if ing.is_active == 1 %}
              <span class="badge success">Active</span>
            {% else %}
              <span class="badge muted">Inactive</span>
            {% endif %}
          </td>

          <!-- Actions -->
          <td>
  {% if ing.is_active == 1 %}
    <form method="post"
          style="display:inline;"
          onsubmit="return confirm('Deactivate this ingredient?');">
      <input type="hidden" name="action" value="remove">
      <input type="hidden" name="warehouse_item_id"
             value="{{ ing.warehouse_item_id }}">
      <button class="danger">Deactivate</button>
    </form>
  {% else %}
    <form method="post" style="display:inline;">
      <input type="hidden" name="action" value="activate">
      <input type="hidden" name="warehouse_item_id"
             value="{{ ing.warehouse_item_id }}">
      <button class="btn-secondary">Activate</button>
    </form>
  {% endif %}
</td>

        </tr>
        {% endfor %}

      </tbody>
    </table>
  {% else %}
    <p class="empty">No ingredients added yet.</p>
  {% endif %}
</div>

<!-- ================= BACK BUTTON ================= -->
<div class="card">
  <a href="{{ url_for('recipes') }}" class="btn-secondary">
    ‚Üê Back to Recipes
  </a>
</div>

{% endblock %}
